---
sidebar_position: 1
---

# How to Use Your Checkpoint?

## Introduction

PeriFlow allows you to easily upload your own AI model checkpoint from your local machine to the desired PeriFlow project.
This guide will walk you through the steps to upload the checkpoint using the PeriFlow Client.

## Prerequisites

Before you begin, make sure you have the PeriFlow Client installed.
You can install it with the following command, which also includes the necessary machine learning library (`mllib`) dependencies:

```sh
pip install periflow-client[mllib]
```

:::info
### Converting Hugging Face Checkpoint (Optional)

If you have a Hugging Face checkpoint and want to convert it to a PeriFlow-compatible format, you need to install the package with the following command:

```sh
pip install periflow-client[mllib]
```

If you don't need to convert the checkpoint, you can install the package without the `mllib` dependencies:

```sh
pip install periflow-client
```

Note that the PeriFlow Client package requires Python version >= 3.8.
:::

## Step 1. Signing in with PeriFlow

To use the PeriFlow CLI and upload your AI model checkpoint, you need to sign in with your PeriFlow account. Follow these steps:

1. Open a terminal shell.
2. Enter the following command:

```sh
pf login
```

3. When prompted, provide your PeriFlow account credentials, including your ID and password. After successful login, you will see the following output:

```txt
Enter Username: <YOUR_ID>
Enter Password:


Login success!
Welcome back to...
 _____          _  _____ _
|  __ \___ _ __(_)|  ___| | _____      __
|  ___/ _ \ '__| || |__ | |/ _ \ \ /\ / /
| |  |  __/ |  | ||  __|| | (_) | V  V /
|_|   \___|_|  |_||_|   |_|\___/ \_/\_/

```

## Step 2. Switching to Your Project

Now that you are logged in, you can switch to the PeriFlow project where you want to upload the checkpoint. Follow these steps:

1. Open a terminal shell (if not already open).
2. Use the following command to switch to your desired project, replacing `$YOUR_PROJECT_NAME` with the actual project name:

```sh
pf project switch $YOUR_PROJECT_NAME
```

:::info
If you are not sure about the available projects, you can list them using the following command:

```sh
pf project list
```
:::

## Step 3. Converting Hugging Face Checkpoint (Optional)

If you want to serve your AI model with PeriFlow, you'll need to convert it to the PeriFlow-compatible format.
Here's how you can easily convert a Hugging Face model checkpoint to the PeriFlow format:

1. Open a terminal shell (if not already open).
2. Use the following command to convert the Hugging Face model checkpoint to the PeriFlow-compatible format. Replace `$MODEL_NAME_OR_PATH`, `$OUTPUT_DIR`, and `$DATA_TYPE` with the actual values you want.

```sh
pf checkpoint convert \
    --model-name-or-path $MODEL_NAME_OR_PATH \
    --output-dir $OUTPUT_DIR \
    --data-type $DATA_TYPE
```

:::info
You have two options for `$MODEL_NAME_OR_PATH`:

- Enter the local checkpoint path.
- Use the Hugging Face model name (e.g., `gpt2`, `EleutherAI/gpt-j-6b`).

For the `$DATA_TYPE` parameter, you can choose from three options:

- `fp16`: 16-bit floating-point format.
- `fp32`: 32-bit floating-point format.
- `bf16`: bfloat16 format.
:::

3. After executing the above command, the following files will be created at $OUTPUT_DIR:
    - `model.h5`: The converted model checkpoint file with HDF5 format.
    - `tokenizer.json`: Tokenizer file used for tokenizing/detokenizing the model inputs/ouputs.
    - `attr.yaml`: The checkpoint attributes file containing the model configurations and generation configurations.

:::caution
PeriFlow CLI will try to configure `tokenizer.json` and `attr.yaml` automatically, but the automatic configuration might fail in the following cases:

- If the model does support the [**Fast tokenizer**](https://huggingface.co/learn/nlp-course/chapter6/3), which is compatible with PeriFlow, `tokenizer.json` will not be created.
- If the model config or generation config published to Hugging Face does not contain the required information, the value will be left blank (marked with "FILL ME") in `attr.yaml`.
- If there is a conflict between the model config and the generation config published to the Hugging Face, the value will be left blank (marked with "FILL ME") in `attr.yaml`.
:::

After completing this step, your Hugging Face model checkpoint will be converted to the PeriFlow-compatible format, and you'll be able to use it with PeriFlow seamlessly.

## Step 4. Uploading Checkpoint

Once your checkpoint is prepared, you can upload it to PeriFlow using the following steps:

1. Open a terminal shell (if not already open).
2. Use the following command to upload the model checkpoint file (`model.h5`) and the tokenizer file (`tokenizer.json`).

```sh
pf checkpoint upload \
    --name $CHECKPOINT_NAME \
    --source-path $SOURCE_PATH \
    --attr-file $ATTR_FILE_PATH
```

:::info
Replace the placeholders with the appropriate values:

- `$CHECKPOINT_NAME`: Enter the desired name for your checkpoint.
- `$SOURCE_PATH`: Provide the path to the directory containing `model.h5` and `tokenizer.json`.
- `$ATTR_FILE_PATH`: Specify the path to `attr.yaml`, which contains the model configurations and generation configurations.
:::

After following these steps, your model checkpoint will be successfully uploaded to your PeriFlow project, ready to be used for AI model serving.
