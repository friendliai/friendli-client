# Completion

<a href="https://github.com/friendliai/periflow-client/tree/main/periflow/sdk/api/completion.py">
    <img src="https://img.shields.io/badge/View%20source%20on%20GitHub-181717?style=for-the-badge&logo=Github" />
</a>

# _class_ `Completion()`

> Bases: ServingAPI[V1Completion, 'V1CompletionStream', 'V1AsyncCompletionStream', V1CompletionOptions]

PeriFlow Completion API.
## Methods

### _def_ `create`

```python
create(
    options: V1CompletionOptions,
    stream: bool = False
) -> Union[V1CompletionStream, V1Completion]
```

Creates a completion.

#### Arguments

| Name | Type | Description | Default | Optional |
|------|------|-------------|---------|----------|
| `options` | `V1CompletionOptions` | Options for the completion. | - | ❌ |
| `stream` | `bool` | Enables streaming mode. Defaults to False. | `False` | ✅ |

#### Returns

| Type | Description |
|------|-------------|
| `Union[V1Completion, CompletionStream]` | If `stream` is `True`, a `CompletionStream` object that iterates the results per token is returned. Otherwise, a `V1CompletionResult` object is returned. |
#### Raises

| Type | Description |
|------|-------------|
| `APIError` | Raised when the HTTP API request to the deployment fails. |

### _async def_ `acreate`

```python
acreate(
    options: V1CompletionOptions,
    stream: bool = False
) -> Union[V1AsyncCompletionStream, V1Completion]
```

Creates a completion.
:::info
You must open API session with `api_session()` before `acreate()`.
:::

#### Arguments

| Name | Type | Description | Default | Optional |
|------|------|-------------|---------|----------|
| `options` | `V1CompletionOptions` | Options for the completion. | - | ❌ |
| `stream` | `bool` | When set True, enables streaming mode. Defaults to False. | `False` | ✅ |

#### Returns

| Type | Description |
|------|-------------|
| `Union[V1Completion, AsyncCompletionStream]` | If `stream` is `True`, a `AsyncCompletionStream` object that iterates the results per token is returned. Otherwise, a `V1CompletionResult` object is returned. |
#### Raises

| Type | Description |
|------|-------------|
| `APIError` | Raised when the HTTP API request to the deployment fails. |
| `SessionClosedError` | Raised when the client session is not opened with `api_session()`. |

#### Examples

Basic usage:

```python
from periflow import Completion, V1CompletionOptions

api = Completion(deployment_id="periflow-deployment-1b9483a0")
async with api.api_session():
    completion = await api.acreate(
        options=V1CompletionOptions(
            prompt="Python is a popular language for",
            max_tokens=100,
            top_p=0.8,
            temperature=0.5,
            no_repeat_ngram=3,
        )
    )

print(completion.choices[0].text)
```

Usage of streaming mode:

```python
from periflow import Completion, V1CompletionOptions

api = Completion(deployment_id="periflow-deployment-1b9483a0")
async with api.api_session():
    astream = await api.acreate(
        options=V1CompletionOptions(
            prompt="Python is a popular language for",
            max_tokens=100,
            top_p=0.8,
            temperature=0.5,
            no_repeat_ngram=3,
        ),
        stream=True,
    )

    # Iterate over a generation stream.
    async for line in astream:
        print(line.text)

    # Or you can wait for the generation stream to complete.
    completion = await astream.wait()
```

# _class_ `V1CompletionStream()`

> Bases: GenerationStream[V1CompletionLine, V1Completion]

Completion stream.
## Methods

### _def_ `wait`

```python
wait() -> Optional[V1Completion]
```

Waits for the generation to complete.

#### Returns

| Type | Description |
|------|-------------|
| `Optional[V1Completion]` | The full generation result. |
#### Raises

| Type | Description |
|------|-------------|
| `InvalidGenerationError` | Raised when the generation result has invalid format. |

# _class_ `V1AsyncCompletionStream()`

> Bases: AsyncGenerationStream[V1CompletionLine, V1Completion]

Asynchronous completion stream.
## Methods

### _async def_ `wait`

```python
wait() -> Optional[V1Completion]
```

Waits for the generation to complete.

#### Returns

| Type | Description |
|------|-------------|
| `Optional[V1Completion]` | The full generation result. |
#### Raises

| Type | Description |
|------|-------------|
| `InvalidGenerationError` | Raised when the generation result has invalid format. |
